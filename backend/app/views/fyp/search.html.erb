<div class="search-container">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <div class="search-header mb-4">
        <h1 class="search-title">Search</h1>
        
        <%= form_with url: fyp_search_path, method: :get, local: true, class: "search-form" do |form| %>
          <div class="input-group mb-3">
            <%= form.text_field :q, 
                class: "form-control search-input", 
                placeholder: "Search for users or events...", 
                value: @query,
                autofocus: true %>
            <%= form.hidden_field :filter, value: @filter, id: 'search_filter' %>
            <%= form.submit "Search", class: "btn btn-primary search-btn" %>
          </div>
        <% end %>
        
        <div class="filter-buttons">
          <%= link_to fyp_search_path(q: @query, filter: 'user'), 
              class: "filter-btn #{'active' if @filter == 'user'}",
              onclick: "document.getElementById('search_filter').value = 'user'; return true;" do %>
            <span>ğŸ‘¤</span> Users
          <% end %>
          <%= link_to fyp_search_path(q: @query, filter: 'event'), 
              class: "filter-btn #{'active' if @filter == 'event'}",
              onclick: "document.getElementById('search_filter').value = 'event'; return true;" do %>
            <span>ğŸŸï¸</span> Events
          <% end %>
        </div>
      </div>

      <% if @query.present? %>
        <div class="search-results">
          <% if @results.present? %>
            <div class="results-header mb-3">
              <h3>Found <%= @count %> <%= @filter == 'user' ? 'user' : 'field' %><%= @count != 1 ? 's' : '' %></h3>
            </div>
            
            <% if @filter == 'user' %>
              <div class="users-results">
                <% @results.each do |user| %>
                  <%= link_to fyp_user_page_path(username: user['username']), class: "result-card-link" do %>
                    <div class="result-card user-card">
                      <div class="result-card-body">
                        <div class="user-avatar">
                          <%= user['username']&.first&.upcase || 'U' %>
                        </div>
                        <div class="result-info">
                          <h4 class="result-title"><%= user['username'] %></h4>
                          <% if user['bio'].present? %>
                            <p class="result-description"><%= truncate(user['bio'], length: 100) %></p>
                          <% end %>
                          <% if user['city'].present? || user['state'].present? %>
                            <p class="result-meta">ğŸ“ <%= [user['city'], user['state']].compact.join(', ') %></p>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>
            <% else %>
              <div class="events-results">
                <% @results.each do |event| %>
                  <div class="result-card event-card">
                    <div class="result-card-body">
                      <div class="event-icon">ğŸŸï¸</div>
                      <div class="result-info">
                        <h4 class="result-title"><%= event['event_name'] %></h4>
                        <% if event['address'].present? %>
                          <p class="result-meta">ğŸ“ <%= event['address'] %></p>
                        <% end %>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="no-results">
              <p class="no-results-text">No <%= @filter == 'user' ? 'users' : 'events' %> found matching "<%= @query %>"</p>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="search-prompt">
          <p class="prompt-text">Enter a search term above to find users or events</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
