<div class="notifications-container">
  <div class="notifications-tabs mb-4">
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="tab-follow-requests" data-bs-toggle="tab" data-bs-target="#follow-requests" type="button" role="tab" aria-controls="follow-requests" aria-selected="true">Follow Requests</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-joined-events" data-bs-toggle="tab" data-bs-target="#joined-events" type="button" role="tab" aria-controls="joined-events" aria-selected="false">Joined Events</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-hosted-events" data-bs-toggle="tab" data-bs-target="#hosted-events" type="button" role="tab" aria-controls="hosted-events" aria-selected="false">Hosted Events</button>
      </li>
    </ul>
  </div>

  <div class="tab-content">
    <div class="tab-pane fade show active" id="follow-requests" role="tabpanel" aria-labelledby="tab-follow-requests">
      <% if @follow_requests && @follow_requests.any? %>
        <div class="notifications-list">
          <% @follow_requests.each do |request| %>
            <div class="notification-card">
              <div class="notification-avatar">
                <%= request['username']&.first&.upcase || 'U' %>
              </div>
              <div class="notification-info">
                <h4 class="notification-username">
                  <%= link_to request['username'], fyp_user_page_path(username: request['username']), class: "notification-link" %>
                </h4>
                <p class="notification-text">wants to follow you</p>
              </div>
              <div class="notification-actions">
                <%= form_with url: fyp_accept_follow_request_path, method: :post, local: true, class: "d-inline me-2" do |form| %>
                  <%= form.hidden_field :username, value: request['username'] %>
                  <%= form.submit "Accept", class: "btn btn-primary btn-sm" %>
                <% end %>
                <%= form_with url: fyp_reject_follow_request_path, method: :post, local: true, class: "d-inline" do |form| %>
                  <%= form.hidden_field :username, value: request['username'] %>
                  <%= form.submit "Reject", class: "btn btn-outline-secondary btn-sm" %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="no-notifications">
          <p class="no-notifications-text">
            You don't have any follow requests at the moment.
          </p>
        </div>
      <% end %>
    </div>

    <div class="tab-pane fade" id="joined-events" role="tabpanel" aria-labelledby="tab-joined-events">
      <% if @joined_events && @joined_events.any? %>
        <div class="notifications-list">
          <% @joined_events.each do |event| %>
            <div class="notification-card">
              <div class="notification-avatar event-avatar">
              <%= link_to fyp_event_page_path(event_name: event['event_name']), class: "event-link" do %>
                <%= event['event_name']&.first&.upcase || 'E' %>
              <% end %>
              </div>
              <div class="notification-info flex-grow-1">
                <h4 class="notification-username mb-1">
                  <%= event['event_name'] %>
                </h4>
                <% if event['description'].present? %>
                  <p class="notification-text mb-1"><%= truncate(event['description'], length: 80) %></p>
                <% end %>
                <p class="notification-text small text-muted mb-0">
                  <% if event['date_time'].present? %>
                    <%= event['date_time'] %>
                  <% end %>
                  <% if event['current_players'].present? && event['max_players'].present? %>
                    · <%= event['current_players'] %> / <%= event['max_players'] %> players
                  <% end %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="no-notifications">
          <p class="no-notifications-text">
            You haven't joined any events yet.
          </p>
        </div>
      <% end %>
    </div>

    <div class="tab-pane fade" id="hosted-events" role="tabpanel" aria-labelledby="tab-hosted-events">
      <% if @hosted_events && @hosted_events.any? %>
        <div class="notifications-list">
          <% @hosted_events.each do |event| %>
            <div class="notification-card">
              <div class="notification-avatar event-avatar">
                <%= link_to fyp_event_page_path(event_name: event['event_name']), class: "event-link" do %>
                  <%= event['event_name']&.first&.upcase || 'E' %>
                <% end %>
              </div>
              <div class="notification-info flex-grow-1">
                <h4 class="notification-username mb-1">
                  <%= event['event_name'] %>
                </h4>
                <% if event['description'].present? %>
                  <p class="notification-text mb-1"><%= truncate(event['description'], length: 80) %></p>
                <% end %>
                <p class="notification-text small text-muted mb-0">
                  <% if event['date_time'].present? %>
                    <%= event['date_time'] %>
                  <% end %>
                  <% if event['current_players'].present? && event['max_players'].present? %>
                    · <%= event['current_players'] %> / <%= event['max_players'] %> players
                  <% end %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="no-notifications">
          <p class="no-notifications-text">
            You haven't hosted any events yet.
          </p>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  (function() {
    var buttons = document.querySelectorAll('.notifications-container .nav-link');
    var panes = document.querySelectorAll('.notifications-container .tab-pane');

    buttons.forEach(function(btn) {
      btn.addEventListener('click', function() {
        buttons.forEach(function(b) {
          b.classList.remove('active');
          b.setAttribute('aria-selected', 'false');
        });
        panes.forEach(function(p) {
          p.classList.remove('show', 'active');
        });

        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');

        var target = document.querySelector(btn.getAttribute('data-bs-target'));
        if (target) {
          target.classList.add('show', 'active');
        }
      });
    });
  })();
</script>